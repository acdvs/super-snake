'use strict';$(function(){var m=Math.floor;function a(a,b){this.x=a,this.y=b}function b(){if(R=!1,M=H.parts[0].x,N=H.parts[0].y,O=H.parts[H.parts.length-1].x,P=H.parts[H.parts.length-1].y,c(),d(),G.hasBounds&&(M>=G.right||M<G.left||N>=G.bottom||N<G.top))return void h("hit a wall");if(3<H.parts.length)for(var b=4;b<H.parts.length;b++)if(M===H.parts[b].x&&N===H.parts[b].y)return void h("ran into itself");if(I.x===M&&I.y===N){D+=10,$(".score .num").text(D),H.parts.push(new a(O,P)),I.x=j(F.X),I.y=j(F.Y);for(var e=0;e<H.parts.length;e++)I.x===H.parts[e].x&&I.y===H.parts[e].y&&(I.x=j(F.X),I.y=j(F.Y));if(0<J.addCount)for(var f=0;f<J.addCount;f++){var g=void 0,i=void 0;do g=j(F.X),i=j(F.Y);while(g===I.x&&i===I.y||g===M||i===N);J.parts.push(new a(g,i))}}if(0<J.addCount&&1<H.parts.length)for(var k=0;k<J.parts.length;k++)if(M===J.parts[k].x&&N===J.parts[k].y)return void h("hit an obstacle")}function c(){if(1!==H.parts.length)for(var e=H.parts.length-1;0<e;e--){var a=H.parts[e].x,b=H.parts[e].y,c=H.parts[e-1].x,d=H.parts[e-1].y;c===a-r?a-=r:c===a+r?a+=r:d===b-r?b-=r:d===b+r?b+=r:c<a?a+=r:c>a?a-=r:d<b?b+=r:d>b&&(b-=r),G.hasBounds||(0>a?a=G.right-r:a>=G.right?a=0:0>b?b=G.bottom-r:b>=G.bottom&&(b=0)),H.parts[e].x=a,H.parts[e].y=b}}function d(){H.direction===E.LEFT?M-=r:H.direction===E.RIGHT?M+=r:H.direction===E.UP?N-=r:H.direction===E.DOWN&&(N+=r),G.hasBounds||(0>M?M=G.right-r:M>=G.right?M=0:0>N?N=G.bottom-r:N>=G.bottom&&(N=0)),H.parts[0].x=M,H.parts[0].y=N}function e(){if(!R){w.clearRect(0,0,x.width(),x.height()),w.fillStyle=H.color;for(var a=0;a<H.parts.length;a++)w.fillRect(H.parts[a].x,H.parts[a].y,r,r);w.fillStyle=I.color,w.fillRect(I.x,I.y,r,r),w.fillStyle=J.color;for(var b=0;b<J.parts.length;b++)w.fillRect(J.parts[b].x,J.parts[b].y,r,r)}}function f(){var a=6;z=!1,y.css("display","none"),$("input").attr("disabled",!0),$(".newgame p").text("End Game");var b=setInterval(function(){0==a%2&&0!==a?(x.css("border","10px solid #ff0000"),$("#count p").text(a/2)):x.css("border","10px solid #333333"),0>--a&&($("#count p").text(""),clearInterval(b),g())},500)}function g(){Q=setInterval(function(){b(),e(),H.directionCanChange=!0},B),A=!0,R=!1,D=0,H.direction=E.RIGHT,H.parts=[new a(0,0)],I.x=j(F.X),I.y=j(F.Y),J.parts=[],$(".score .num").text("0"),$(".gameover, .reason").remove(),e()}function h(a){w.clearRect(0,0,x.width(),x.height()),clearInterval(Q),z=!0,A=!1,R=!0,y.css("display","initial"),y.prepend("<p class=\"reason\">The snake "+a+".</p>","<p class=\"gameover\">Game Over</p>"),$(".menucover").remove(),$("input").attr("disabled",!1),$(".newgame p").text("New Game")}function i(){z&&f(),A&&h("escaped")}function j(a){var b=a===F.X?q:p,c=r*m(Math.random()*b);return c}function k(a){var b=m(a),c=r*m(b/r);return c}function l(){r=self===top?m(s/40):m($(self).width()/45),u=k(u),v=k(v),n=k(y.height()),o=k(y.width()),x.height(u),x.width(u),x.attr({width:x.width(),height:x.height()}),$(".stageh").attr({max:u,min:n+80,value:u,step:r}),$(".stagew").attr({max:v,min:o+20,value:u,step:r}),p=x.height()/r,q=x.width()/r,G.bottom=x.height(),G.right=x.width(),console.log("Global interval: "+r)}var n,o,p,q,r,s=$(window).height(),t=$(window).width(),u=s-134,v=t-60,w=document.getElementById("stage").getContext("2d"),x=$("#stage"),y=$("#cover"),z=!0,A=!1,B=$(".speed").val(),C=$(".speedcont .val").text(),D=0,E={UP:0,RIGHT:1,DOWN:2,LEFT:3},F={X:0,Y:1},G={top:0,left:0,bottom:x.height(),right:x.width(),hasBounds:!0},H={parts:[],direction:E.RIGHT,directionCanChange:!0,color:"#ff0000"},I={x:0,y:0,color:"#ffffff"},J={parts:[],addCount:0,color:"#333333"};l(),self!==top&&$(".sizecont").remove();var K,L;$(".newgame").on("click",i),$(".bounds").change(function(){G.hasBounds=$(".bounds").prop("checked")}),$(".obst").change(function(){J.addCount=$(".obst").val(),$(".obstcont .val").text(J.addCount)}),$(".speed").change(function(){B=$(".speed").val(),C=72<B?"slow":46<B?"normal":"fast",$(".speedcont .val").text(C)}),$(".stageh").change(function(){K=k($(".stageh").val()),x.height(K),x.prop("height",K),G.bottom=x.height(),p=x.height()/r}),$(".stagew").change(function(){L=k($(".stagew").val()),x.width(L),x.prop("width",L),G.right=x.width(),q=x.width()/r}),$(window).on("keydown",function(a){switch([13,27,37,38,39,40].includes(a.which)&&a.preventDefault(),a.which){case 37:H.directionCanChange&&H.direction!==E.RIGHT&&(H.direction=E.LEFT);break;case 39:H.directionCanChange&&H.direction!==E.LEFT&&(H.direction=E.RIGHT);break;case 38:H.directionCanChange&&H.direction!==E.DOWN&&(H.direction=E.UP);break;case 40:H.directionCanChange&&H.direction!==E.UP&&(H.direction=E.DOWN);break;case 13:z&&f();break;case 27:A&&h("escaped");}[37,38,39,40].includes(a.which)&&(H.directionCanChange=!1,0)});var M,N,O,P,Q,R=!1});